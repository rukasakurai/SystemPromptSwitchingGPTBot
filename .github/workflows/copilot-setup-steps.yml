# Workflow for GitHub Copilot Coding Agent to access Azure resources via Azure MCP Server
# This enables Copilot to interact with Azure services using OIDC federated credentials
# Reference: https://learn.microsoft.com/en-us/azure/developer/azure-mcp-server/how-to/github-copilot-coding-agent
name: GitHub Copilot - Azure MCP Server Authentication
on:
  workflow_dispatch:
permissions:
  id-token: write  # Required for OIDC token request
  contents: read
jobs:
  copilot-setup-steps:
    runs-on: ubuntu-latest
    permissions:
      id-token: write  # Required for OIDC authentication with Azure
      contents: read
    environment: copilot  # Uses environment variables from 'copilot' environment
    steps:
      # Install Azure Developer CLI for potential azd commands
      - name: Install azd
        uses: Azure/setup-azd@v2
      # Authenticate to Azure using OIDC federated credentials
      # This enables passwordless authentication using managed identity
      - name: Azure login
        uses: azure/login@v2
        with:
          client-id: ${{ vars.AZURE_CLIENT_ID }}  # Managed identity client ID
          tenant-id: ${{ vars.AZURE_TENANT_ID }}  # Azure AD tenant ID
          subscription-id: ${{ vars.AZURE_SUBSCRIPTION_ID }}  # Azure subscription ID
